---

title: DWPC


keywords: fastai
sidebar: home_sidebar

summary: "DWPC calculation"
description: "DWPC calculation"
nb_path: "01_dwpc.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_dwpc.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_dwpc_query" class="doc_header"><code>make_dwpc_query</code><a href="https://github.com/me/neo4jtools/tree/{branch}/neo4jtools/dwpc.py#L6" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_dwpc_query</code>(<strong><code>genes</code></strong>, <strong><code>reltype</code></strong>, <strong><code>hops</code></strong>, <strong><code>dwpc_score_prop_name</code></strong>=<em><code>'dwpc_score'</code></em>, <strong><code>only_relations_with_pmid</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Make a cypher query to calculate DWPC</p>
<p>input parameters</p>
<p>genes : gene list
reltype : edge type
hops : number of hops to calculate
dwpc_score_prop_name : name of dwpc score property, default dwpc_score
only_relations_with_pmid : include only relations with pubmed_id</p>
<p>output
query:string</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="patterns_to_query" class="doc_header"><code>patterns_to_query</code><a href="https://github.com/me/neo4jtools/tree/{branch}/neo4jtools/dwpc.py#L73" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>patterns_to_query</code>(<strong><code>patterns</code></strong>)</p>
</blockquote>
<p>Convert pattern list to cypher query</p>
<p>Example</p>
<p>input patterns:list:</p>
<p>["(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'201633'})",
"(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'2533'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'201633'})",
"(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'7827'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'201633'})",
"(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'55243'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'201633'})"]</p>
<p>output query:string
"MATCH p0=(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'201633'})
MATCH p1=(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'2533'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'201633'})
MATCH p2=(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'7827'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'201633'})
MATCH p3=(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'55243'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'2534'})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:'201633'})
RETURN p0,p1,p2,p3"</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test-make_dwpc_query">Test <a href="/neo4jtools/dwpc.html#make_dwpc_query"><code>make_dwpc_query</code></a><a class="anchor-link" href="#Test-make_dwpc_query"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">genes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LEF1&#39;</span><span class="p">,</span><span class="s1">&#39;TCF7&#39;</span><span class="p">,</span><span class="s1">&#39;SERINC5&#39;</span><span class="p">]</span>
<span class="n">reltype</span><span class="o">=</span><span class="s1">&#39;INTERACTS_GiG3&#39;</span>
<span class="n">hops</span><span class="o">=</span><span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">query</span><span class="o">=</span><span class="n">make_dwpc_query</span><span class="p">(</span><span class="n">genes</span><span class="p">,</span> <span class="n">reltype</span><span class="p">,</span> <span class="n">hops</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>MATCH p=(n0:Gene)-[:INTERACTS_GiG3|INTERACTS_GiG3*..2]-&gt;(n1:Gene) 
    WHERE n0.name in [&#39;LEF1&#39;,&#39;TCF7&#39;,&#39;SERINC5&#39;]
      AND n1.name in [&#39;LEF1&#39;,&#39;TCF7&#39;,&#39;SERINC5&#39;]
      AND n0 &lt;&gt; n1
      
    WITH 
        n0.name as source_name
      , n1.name as target_name
      , p as path
      , [r in relationships(p)|r.dwpc_score] as dwpc_scores
      , [r in relationships(p) | r.pubmed_id] as pubmed_ids
    WITH 
        source_name
      , target_name
      , length(path) as len
      , reduce(acc=1, d in dwpc_scores|acc*d) as dwpc_score
      , [n IN nodes(path) | labels(n)[0]] as node_labels
      , [n IN nodes(path) | n.identifier] as node_identifiers
      , [r IN relationships(path) | type(r)] as rel_types
      , reduce(acc=&#39;&#39;, s in pubmed_ids | acc+&#39;;&#39;+s) as pubmed_ids
    WITH 
        source_name
      , target_name
      , dwpc_score as dwpc
      , [r IN rel_types | split(r, &#39;_&#39;)[1]] as rtypes
      , &#34;(:&#34;+node_labels[0]+&#34;{identifier:&#39;&#34;+ node_identifiers[0] +&#34;&#39;})&#34; as head
      , [i IN range(0,len-1)| &#34;-[:&#34;+ rel_types[i] +&#34;]-&gt;(:&#34;+node_labels[i+1]+&#34;{identifier:&#39;&#34;+ node_identifiers[i+1] +&#34;&#39;})&#34; ] as tail
      , substring(pubmed_ids,1) as pubmed_ids
    RETURN 
        source_name
      , target_name
      , dwpc
      , head + reduce(acc=&#39;&#39;, s in tail |acc+s) as pattern
      , reduce(acc=&#39;&#39;, s IN rtypes | acc + s) as type_pattern
      , pubmed_ids
    
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">genes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LEF1&#39;</span><span class="p">,</span><span class="s1">&#39;TCF7&#39;</span><span class="p">,</span><span class="s1">&#39;SERINC5&#39;</span><span class="p">]</span>
<span class="n">reltype</span><span class="o">=</span><span class="s1">&#39;INTERACTS_GiG3|INTERACTS_GiG3&#39;</span>
<span class="n">hops</span><span class="o">=</span><span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">query</span><span class="o">=</span><span class="n">make_dwpc_query</span><span class="p">(</span><span class="n">genes</span><span class="p">,</span> <span class="n">reltype</span><span class="p">,</span> <span class="n">hops</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>MATCH p=(n0:Gene)-[:INTERACTS_GiG3|INTERACTS_GiG3*..2]-&gt;(n1:Gene) 
    WHERE n0.name in [&#39;LEF1&#39;,&#39;TCF7&#39;,&#39;SERINC5&#39;]
      AND n1.name in [&#39;LEF1&#39;,&#39;TCF7&#39;,&#39;SERINC5&#39;]
      AND n0 &lt;&gt; n1
      
    WITH 
        n0.name as source_name
      , n1.name as target_name
      , p as path
      , [r in relationships(p)|r.dwpc_score] as dwpc_scores
      , [r in relationships(p) | r.pubmed_id] as pubmed_ids
    WITH 
        source_name
      , target_name
      , length(path) as len
      , reduce(acc=1, d in dwpc_scores|acc*d) as dwpc_score
      , [n IN nodes(path) | labels(n)[0]] as node_labels
      , [n IN nodes(path) | n.identifier] as node_identifiers
      , [r IN relationships(path) | type(r)] as rel_types
      , reduce(acc=&#39;&#39;, s in pubmed_ids | acc+&#39;;&#39;+s) as pubmed_ids
    WITH 
        source_name
      , target_name
      , dwpc_score as dwpc
      , [r IN rel_types | split(r, &#39;_&#39;)[1]] as rtypes
      , &#34;(:&#34;+node_labels[0]+&#34;{identifier:&#39;&#34;+ node_identifiers[0] +&#34;&#39;})&#34; as head
      , [i IN range(0,len-1)| &#34;-[:&#34;+ rel_types[i] +&#34;]-&gt;(:&#34;+node_labels[i+1]+&#34;{identifier:&#39;&#34;+ node_identifiers[i+1] +&#34;&#39;})&#34; ] as tail
      , substring(pubmed_ids,1) as pubmed_ids
    RETURN 
        source_name
      , target_name
      , dwpc
      , head + reduce(acc=&#39;&#39;, s in tail |acc+s) as pattern
      , reduce(acc=&#39;&#39;, s IN rtypes | acc + s) as type_pattern
      , pubmed_ids
    
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client</span><span class="o">=</span><span class="n">SimpleNeo4jHTTPAPIClient</span><span class="p">(</span><span class="s1">&#39;http://localhost:7474&#39;</span><span class="p">)</span>
<span class="n">client</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#34;classname&#34;: &#34;SimpleNeo4jHTTPAPIClient&#34;, &#34;url&#34;: &#34;http://localhost:7474&#34;, &#34;neo4j_version&#34;: &#34;4.4.3&#34;, &#34;neo4j_edition&#34;: &#34;community&#34;, &#34;db&#34;: &#34;neo4j&#34;, &#34;auth&#34;: false}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">execute_read_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="s1">&#39;The DWPC query is not working.&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test-patterns_to_query">Test <a href="/neo4jtools/dwpc.html#patterns_to_query"><code>patterns_to_query</code></a><a class="anchor-link" href="#Test-patterns_to_query"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">patterns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;})&quot;</span><span class="p">,</span>
    <span class="s2">&quot;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2533&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;})&quot;</span><span class="p">,</span>
    <span class="s2">&quot;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;7827&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;})&quot;</span><span class="p">,</span>
    <span class="s2">&quot;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;55243&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;})&quot;</span><span class="p">]</span>
<span class="n">patterns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#34;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;})&#34;,
 &#34;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2533&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;})&#34;,
 &#34;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;7827&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;})&#34;,
 &#34;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;55243&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;})&#34;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">query</span><span class="o">=</span><span class="n">patterns_to_query</span><span class="p">(</span><span class="n">patterns</span><span class="p">)</span>
<span class="n">query</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#34;MATCH p0=(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;})  MATCH p1=(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2533&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;})  MATCH p2=(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;7827&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;})  MATCH p3=(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;55243&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;2534&#39;})-[:INTERACTS_GiG3]-&gt;(:Gene{identifier:&#39;201633&#39;}) RETURN p0,p1,p2,p3&#34;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">client</span><span class="o">.</span><span class="n">execute_read_query</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="s1">&#39;Converted query from patterns is not working.&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

